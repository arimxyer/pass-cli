# Configuration File Contract: config.yml
# Version: 1.1.0 (adds vault_path field)
# Feature: Remove --vault Flag and Simplify Vault Path Configuration

schema_version: "1.0"
config_format: YAML

fields:
  # Existing fields (preserved for backward compatibility)
  terminal:
    type: object
    required: false
    description: "Terminal size warning configuration"
    fields:
      warning_enabled:
        type: boolean
        required: false
        default: true
        description: "Enable or disable terminal size warnings"

      min_width:
        type: integer
        required: false
        default: 60
        validation:
          min: 1
          max: 10000
        description: "Minimum terminal width in columns before warning"

      min_height:
        type: integer
        required: false
        default: 30
        validation:
          min: 1
          max: 1000
        description: "Minimum terminal height in rows before warning"

  keybindings:
    type: object
    required: false
    description: "Keyboard shortcuts for TUI mode"
    default: {} # Uses internal defaults if not specified
    validation:
      - "Keys must be valid key strings (e.g., 'q', 'ctrl+q', 'f1')"
      - "No duplicate key assignments allowed"
      - "Must contain standard actions: quit, add_credential, delete_credential, etc."

  # NEW FIELD: vault_path
  vault_path:
    type: string
    required: false
    default: "" # Empty string = use default location $HOME/.pass-cli/vault.enc
    description: |
      Custom vault file location. Supports:
      - Absolute paths: /custom/path/vault.enc
      - Home-relative paths: ~/Dropbox/vault.enc
      - Environment variables: $HOME/secure/vault.enc (Unix) or %USERPROFILE%\vault.enc (Windows)
      - Relative paths: vault.enc (resolved to $HOME/vault.enc)

    validation:
      - "Must not contain null bytes (\\x00)"
      - "Parent directory should exist (warning if not)"
      - "Relative paths will be resolved relative to home directory (warning)"

    examples:
      - "" # Use default
      - "/absolute/path/to/vault.enc"
      - "~/Dropbox/pass-cli-vault.enc"
      - "$HOME/secure/vault.enc"
      - "%USERPROFILE%\\Documents\\vault.enc" # Windows
      - "vault.enc" # Resolved to $HOME/vault.enc

# Example complete configuration file
example: |
  # Pass-CLI Configuration File

  terminal:
    warning_enabled: true
    min_width: 60
    min_height: 30

  keybindings:
    quit: "q"
    add_credential: "a"
    edit_credential: "e"
    delete_credential: "d"
    toggle_detail: "i"
    toggle_sidebar: "s"
    help: "?"
    search: "/"
    confirm: "enter"
    cancel: "esc"

  # NEW: Vault location
  vault_path: "~/Dropbox/pass-cli-vault.enc"

# Backward compatibility guarantees
backward_compatibility:
  - "Configs without vault_path field continue to work (use default location)"
  - "All existing terminal and keybindings settings preserved"
  - "Schema version bumped to 1.1.0 (minor version = additive change)"

# Breaking changes (none for this feature)
breaking_changes: []

# Deprecations (none for this feature)
deprecations: []

# Migration guide reference
migration_guide: |
  Users who previously used --vault flag should:
  1. Identify their custom vault path from --vault usage
  2. Add vault_path: <path> to config.yml
  3. Remove --vault from scripts/aliases

  Example migration:
    Before: pass-cli --vault /custom/vault.enc get github
    After:
      - Edit ~/.config/pass-cli/config.yml
      - Add: vault_path: /custom/vault.enc
      - Run: pass-cli get github
